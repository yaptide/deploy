# https://docs.ansible.com/ansible/latest/collections/ansible/builtin/git_module.html
- name: Git checkout
  ansible.builtin.git: # noqa: latest
    repo: 'https://github.com/yaptide/ui'
    dest: '{{ frontend_repo_workdir }}'
    version: '{{ frontend_repo_version }}'

- name: Print build information
  ansible.builtin.debug:
    msg: "Building for backend http://{{ frontend_backend_hostname }}:5000"

- name: Create .env file with REACT_APP_BACKEND_URL
  ansible.builtin.blockinfile:
    path: '{{ frontend_repo_workdir }}/.env'
    mode: '0640'
    create: true
    block: |
      REACT_APP_BACKEND_URL = http://{{ frontend_backend_hostname }}:5000

# https://docs.ansible.com/ansible/latest/collections/community/docker/docker_compose_module.html
- name: Run `docker-compose up` to bring up the frontend
  community.docker.docker_compose:
    project_src: '{{ frontend_repo_workdir }}'

- name: Show where frontend is running
  ansible.builtin.debug:
    msg: "Yaptide platform is available at http://{{ frontend_ui_hostname }} "
